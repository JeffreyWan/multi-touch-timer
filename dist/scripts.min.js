(function(e){"use strict";function n(){if(t.READY)return;t.event.determineEventTypes();for(var e in t.gestures)t.gestures.hasOwnProperty(e)&&t.detection.register(t.gestures[e]);t.event.onTouch(document,t.EVENT_MOVE,t.detection.detect),t.event.onTouch(document,t.EVENT_END,t.detection.endDetect),t.READY=!0}var t=function(e,n){return new t.Instance(e,n||{})};t.defaults={stop_browser_behavior:{userSelect:"none",touchCallout:"none",touchAction:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},t.HAS_POINTEREVENTS=navigator.msPointerEnabled,t.HAS_TOUCHEVENTS="ontouchstart"in e,t.EVENT_TYPES={},t.DIRECTION_DOWN="down",t.DIRECTION_LEFT="left",t.DIRECTION_UP="up",t.DIRECTION_RIGHT="right",t.POINTER_MOUSE="mouse",t.POINTER_TOUCH="touch",t.EVENT_START="start",t.EVENT_MOVE="move",t.EVENT_END="end",t.plugins={},t.READY=!1,t.Instance=function(e,r){var i=this;return n(),this.element=e,this.enabled=!0,this.options=t.utils.extend(t.utils.extend({},t.defaults),r||{}),this.options.stop_browser_behavior&&t.utils.stopDefaultBrowserBehavior(this),t.event.onTouch(e,t.EVENT_START,function(e){i.enabled&&t.detection.startDetect(i,e)}),this},t.Instance.prototype={on:function(t,n){var r=t.split(" ");for(var i=0;i<r.length;i++)this.element.addEventListener(r[i],n,!1);return this},off:function(t,n){var r=t.split(" ");for(var i=0;i<r.length;i++)this.element.removeEventListener(r[i],n,!1);return this},trigger:function(t,n){var r=document.createEvent("Event");return r.initEvent(t,!0,!0),r.gesture=n,this.element.dispatchEvent(r),this},enable:function(t){return this.enabled=t,this}};var r=null,i=!1,s=!1;t.event={bindDom:function(e,t,n){var r=t.split(" ");for(var i=0;i<r.length;i++)e.addEventListener(r[i],n,!1)},onTouch:function(n,o,u){var a=this;this.bindDom(n,t.EVENT_TYPES[o],function(e){var f=e.type.toLowerCase();f.match(/start|down|move/)&&(e.which===1||f.match(/touch/)||e.pointerType&&e.pointerType==e.MSPOINTER_TYPE_TOUCH)&&(i=!0),f.match(/touch|pointer/)&&(s=!0),i&&(!s||!f.match(/mouse/))&&(t.HAS_POINTEREVENTS&&o!=t.EVENT_END&&t.PointerEvent.updatePointer(o,e),o===t.EVENT_END&&r!==null?e=r:r=e,u.call(t.detection,a.collectEventData(n,o,e)),t.HAS_POINTEREVENTS&&o==t.EVENT_END&&t.PointerEvent.updatePointer(o,e)),f.match(/up|cancel|end/)&&(i=!1,s=!1,t.PointerEvent.reset())})},determineEventTypes:function(){var n;t.HAS_POINTEREVENTS?n=["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel"]:n=["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],t.EVENT_TYPES[t.EVENT_START]=n[0],t.EVENT_TYPES[t.EVENT_MOVE]=n[1],t.EVENT_TYPES[t.EVENT_END]=n[2]},getTouchList:function(n){return t.HAS_POINTEREVENTS?t.PointerEvent.getTouchList():n.touches?n.touches:[{identifier:1,pageX:n.pageX,pageY:n.pageY,target:n.target}]},collectEventData:function(n,r,i){var s=this.getTouchList(i,r),o=t.POINTER_TOUCH;if(i.type.match(/mouse/)||i.poinerType&&i.pointerType===i.MSPOINTER_TYPE_MOUSE)o=t.POINTER_MOUSE;return{center:t.utils.getCenter(s),timestamp:i.timestamp||(new Date).getTime(),target:i.target,touches:s,eventType:r,pointerType:o,srcEvent:i,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return t.detection.stopDetect()}}}},t.PointerEvent={pointers:{},getTouchList:function(){var e=this.pointers,t=[];return Object.keys(e).sort().forEach(function(n){t.push(e[n])}),t},updatePointer:function(e,n){e==t.EVENT_END?delete this.pointers[n.pointerId]:(n.identifier=n.pointerId,this.pointers[n.pointerId]=n)},reset:function(){this.pointers={}}},t.utils={extend:function(t,n){for(var r in n)t[r]=n[r];return t},getCenter:function(t){var n=[],r=[];for(var i=0,s=t.length;i<s;i++)n.push(t[i].pageX),r.push(t[i].pageY);return{pageX:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2,pageY:(Math.min.apply(Math,r)+Math.max.apply(Math,r))/2}},getVelocity:function(t,n,r){return{x:Math.abs(n/t)||0,y:Math.abs(r/t)||0}},getAngle:function(t,n){var r=n.pageY-t.pageY,i=n.pageX-t.pageX;return Math.atan2(r,i)*180/Math.PI},getDirection:function(n,r){var i=Math.abs(n.pageX-r.pageX),s=Math.abs(n.pageY-r.pageY);return i>=s?n.pageX-r.pageX>0?t.DIRECTION_LEFT:t.DIRECTION_RIGHT:n.pageY-r.pageY>0?t.DIRECTION_UP:t.DIRECTION_DOWN},getDistance:function(t,n){var r=n.pageX-t.pageX,i=n.pageY-t.pageY;return Math.sqrt(r*r+i*i)},getScale:function(t,n){return t.length>=2&&n.length>=2?this.getDistance(n[0],n[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,n){return t.length>=2&&n.length>=2?this.getAngle(n[1],n[0])-this.getAngle(t[1],t[0]):0},isVertical:function(n){return n==t.DIRECTION_UP||n==t.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t){var n,r=["webkit","khtml","moz","ms","o",""],i=t.options.stop_browser_behavior;if(!i)return;for(var s=0;s<r.length;s++)for(var o in i)i.hasOwnProperty(o)&&(n=o,r[s]&&(n=r[s]+n.substring(0,1).toUpperCase()+n.substring(1)),t.element.style[n]=i[o]);i.userSelect=="none"&&(t.element.onselectstart=function(){return!1})}},t.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(n,r){if(this.current)return;this.stopped=!1,this.current={inst:n,startEvent:t.utils.extend({},r),lastEvent:!1,name:""},this.detect(r)},detect:function(t){if(!this.current||this.stopped)return;t=this.extendEventData(t);var n=this.current.inst.options;for(var r=0,i=this.gestures.length;r<i;r++){var s=this.gestures[r];if(!this.stopped&&n[s.name]!==!1&&s.handler.call(s,t,this.current.inst)===!1){this.stopDetect();break}}this.current&&(this.current.lastEvent=t)},endDetect:function(t){this.detect(t),this.stopDetect()},stopDetect:function(){this.previous=t.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(n){var r=this.current.startEvent;if(r&&(n.touches.length!=r.touches.length||n.touches===r.touches)){r.touches=[];for(var i=0,s=n.touches.length;i<s;i++)r.touches.push(t.utils.extend({},n.touches[i]))}var o=n.timestamp-r.timestamp,u=n.center.pageX-r.center.pageX,a=n.center.pageY-r.center.pageY,f=t.utils.getVelocity(o,u,a);return t.utils.extend(n,{deltaTime:o,deltaX:u,deltaY:a,velocityX:f.x,velocityY:f.y,distance:t.utils.getDistance(r.center,n.center),angle:t.utils.getAngle(r.center,n.center),direction:t.utils.getDirection(r.center,n.center),scale:t.utils.getScale(r.touches,n.touches),rotation:t.utils.getRotation(r.touches,n.touches),startEvent:r}),n},register:function(n){var r=n.defaults||{};return typeof r[n.name]=="undefined"&&(r[n.name]=!0),t.utils.extend(t.defaults,r),n.index=n.index||1e3,this.gestures.push(n),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},t.gestures=t.gestures||{},t.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(n,r){switch(n.eventType){case t.EVENT_START:clearTimeout(this.timer),t.detection.current.name=this.name,this.timer=setTimeout(function(){t.detection.current.name=="hold"&&r.trigger("hold",n)},r.options.hold_timeout);break;case t.EVENT_MOVE:n.distance>r.options.hold_threshold&&clearTimeout(this.timer);break;case t.EVENT_END:clearTimeout(this.timer)}}},t.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,doubletap_distance:20,doubletap_interval:300},handler:function(n,r){if(n.eventType==t.EVENT_END){var i=t.detection.previous;if(n.deltaTime>r.options.tap_max_touchtime||n.distance>r.options.tap_max_distance)return;i&&i.name=="tap"&&n.timestamp-i.lastEvent.timestamp<r.options.doubletap_interval&&n.distance<r.options.doubletap_distance?t.detection.current.name="doubletap":t.detection.current.name="tap",r.trigger(t.detection.current.name,n)}}},t.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(n,r){if(n.eventType==t.EVENT_END){if(r.options.swipe_max_touches>0&&n.touches.length>r.options.swipe_max_touches)return;if(n.velocityX>r.options.swipe_velocity||n.velocityY>r.options.swipe_velocity)r.trigger(this.name,n),r.trigger(this.name+n.direction,n)}}},t.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1},triggered:!1,handler:function(n,r){if(t.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",n),this.triggered=!1;return}if(r.options.drag_max_touches>0&&n.touches.length>r.options.drag_max_touches)return;switch(n.eventType){case t.EVENT_START:this.triggered=!1;break;case t.EVENT_MOVE:if(n.distance<r.options.drag_min_distance&&t.detection.current.name!=this.name)return;t.detection.current.name=this.name;var i=t.detection.current.lastEvent.direction;r.options.drag_lock_to_axis&&i!==n.direction&&(t.utils.isVertical(i)?n.direction=n.deltaY<0?t.DIRECTION_UP:t.DIRECTION_DOWN:n.direction=n.deltaX<0?t.DIRECTION_LEFT:t.DIRECTION_RIGHT),this.triggered||(r.trigger(this.name+"start",n),this.triggered=!0),r.trigger(this.name,n),r.trigger(this.name+n.direction,n),(r.options.drag_block_vertical&&t.utils.isVertical(n.direction)||r.options.drag_block_horizontal&&!t.utils.isVertical(n.direction))&&n.preventDefault();break;case t.EVENT_END:this.triggered&&r.trigger(this.name+"end",n),this.triggered=!1}}},t.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(n,r){if(t.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",n),this.triggered=!1;return}if(n.touches.length<2)return;r.options.transform_always_block&&n.preventDefault();switch(n.eventType){case t.EVENT_START:this.triggered=!1;break;case t.EVENT_MOVE:var i=Math.abs(1-n.scale),s=Math.abs(n.rotation);if(i<r.options.transform_min_scale&&s<r.options.transform_min_rotation)return;t.detection.current.name=this.name,this.triggered||(r.trigger(this.name+"start",n),this.triggered=!0),r.trigger(this.name,n),s>r.options.transform_min_rotation&&r.trigger("rotate",n),i>r.options.transform_min_scale&&(r.trigger("pinch",n),r.trigger("pinch"+(n.scale<1?"in":"out"),n));break;case t.EVENT_END:this.triggered&&r.trigger(this.name+"end",n),this.triggered=!1}}},t.gestures.Touch={name:"touch",index:-Infinity,defaults:{prevent_default:!1},handler:function(n,r){r.options.prevent_default&&n.preventDefault(),n.eventType==t.EVENT_START&&r.trigger(this.name,n)}},t.gestures.Release={name:"release",index:Infinity,handler:function(n,r){n.eventType==t.EVENT_END&&r.trigger(this.name,n)}},e.Hammer=t,typeof e.define=="function"&&e.define.amd&&e.define("hammer",[],function(){return t})})(window);var MicroEvent=function(){};MicroEvent.prototype={bind:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},unbind:function(e,t){this._events=this._events||{};if(e in this._events==0)return;this._events[e].splice(this._events[e].indexOf(t),1)},trigger:function(e){this._events=this._events||{};if(e in this._events==0)return;for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},MicroEvent.mixin=function(e){var t=["bind","unbind","trigger"];for(var n=0;n<t.length;n++)e.prototype[t[n]]=MicroEvent.prototype[t[n]]};var Timer=function(){this.reset(!0),this.stop(!0)};Timer.prototype={start:function(e){e=e||!1;var t=this;if(this.remaining.time<=0)return!1;this.goal=(new Date).getTime()/1e3+this.remaining.time,this._playingInterval=setInterval(function(){t._tick(),e||t.trigger("tick",t.remaining),t.playing&&t.remaining.time===0&&(t.stop(),t.reset())},1e3),e||this.trigger("start"),!e&&!this.playing&&this.trigger("stateChange",!this.playing),this.playing=!0},stop:function(e){console.log("stop"),e=e||!1,!e&&this.playing&&this.trigger("stateChange",!this.playing),this.playing=!1,clearInterval(this._playingInterval),this._playingInterval=null,e||this.trigger("stop")},reset:function(e){e=e||!1,this.goal=0,this.remaining={hours:0,min:0,secs:0,time:0},e||this.trigger("reset"),e||this.trigger("timeChange")},setRemaining:function(e,t){t=t||!1,this.remaining.time=e,this._updateTimeDetails(t)},_tick:function(e){e=e||!1;if(!this.playing)return!1;var t=(new Date).getTime()/1e3;this.setRemaining(this.goal-t,e),this.goal-t<=0&&!e&&this.trigger("done")},_updateTimeDetails:function(e){e=e||!1,this.remaining.time<0?this.remaining={hours:0,min:0,secs:0,time:0}:(this.remaining.hours=Math.floor(this.remaining.time/3600),this.remaining.min=Math.floor(this.remaining.time%3600/60),this.remaining.secs=Math.floor(this.remaining.time%60)),e||this.trigger("timeChange")},_timeToSecs:function(e,t,n){return(e*60+t)*60+n}};var MultiTouchTimer=function(e,t){var n=this;this.timer=t,this.dom={el:document.getElementById(e)},this.dom.hours=this.dom.el.getElementsByClassName("hours")[0],this.dom.min=this.dom.el.getElementsByClassName("minutes")[0],this.dom.secs=this.dom.el.getElementsByClassName("seconds")[0],this.dom.audio=this.dom.el.getElementsByClassName("sound")[0],this.hammer=Hammer(document.body,{drag_block_horizontal:!1,prevent_default:!0,show_touches:!0,drag_max_touches:3,transform_always_block:!0}),this.hammer.on("drag",MultiTouchTimer.Utils.throttle(function(e){n.stopDaDring();if(n.timer.playing)return!1;var t=e.gesture.direction=="up"?1:e.gesture.direction=="down"?-1:null;if(!t)return!1;e.gesture.touches.length==1&&n.setTime("secs",t),e.gesture.touches.length==2&&n.setTime("min",t),e.gesture.touches.length>=3&&n.setTime("hours",t)},175)),this.hammer.on("doubletap",function(e){n.toggle(e)}),this.hammer.on("pinch",MultiTouchTimer.Utils.throttle(function(e){e.gesture.scale>2&&n.reset(e)},175)),this.timer.bind("timeChange",function(){n.updateDom()}),this.timer.bind("stateChange",function(e){n.updateClass(e)}),this.timer.bind("done",function(){n.driiiiing()})};MultiTouchTimer.prototype={toggle:function(e){this.timer.playing?this.timer.stop():this.timer.start(),this.stopDaDring()},reset:function(e){this.timer.stop(),this.timer.reset(),this.stopDaDring()},setTime:function(e,t){e=="min"&&(t=t==-1&&this.timer.remaining.time<60?0:t*60),e=="hours"&&(t=t==-1&&this.timer.remaining.time<3600?0:t*60*60),this.timer.setRemaining(this.timer.remaining.time+t)},updateDom:function(){this.dom.hours.innerHTML=MultiTouchTimer.Utils.leadingZeros(this.timer.remaining.hours),this.dom.min.innerHTML=MultiTouchTimer.Utils.leadingZeros(this.timer.remaining.min),this.dom.secs.innerHTML=MultiTouchTimer.Utils.leadingZeros(this.timer.remaining.secs)},updateClass:function(e){e?this.dom.el.className=document.body.className="play":this.dom.el.className=document.body.className="pause",this.dringInterval!==null&&(this.dom.el.className=document.body.className="dring")},stopDaDring:function(){clearInterval(this.dringInterval),this.dringInterval=null,this.dom.el.className=="dring"&&this.updateClass(this.timer.playing)},dring:function(){var e=document.createElement("audio"),t=["mp3","ogg"];for(var n=t.length-1;n>=0;n--){var r=document.createElement("source");r.src="sound/time."+t[n],e.appendChild(r)}e.play()},driiiiing:function(){var e=this,t=!!document.createElement("audio").canPlayType;if(!t)return!1;this.stopDaDring(),this.dringInterval=setInterval(function(){e.dring()},1300),this.dring(),this.updateClass(this.timer.playing)}},MultiTouchTimer.Utils={leadingZeros:function(e){return e<=0?e="00":e<10&&(e="0"+e),e},throttle:function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}}},MicroEvent.mixin(Timer);var daTimer=new Timer,daApp=new MultiTouchTimer("timer",daTimer);